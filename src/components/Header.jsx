import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Link, useLocation } from 'react-router-dom';
import * as FiIcons from 'react-icons/fi';
import SafeIcon from '../common/SafeIcon';

const { FiPhone, FiSearch, FiMapPin, FiYoutube, FiInstagram, FiFacebook, FiMenu, FiX, FiChevronDown, FiPenTool, FiBell } = FiIcons;

const Header = () => {
  const [isScrolled, setIsScrolled] = useState(false);
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  const [isSpecialtiesOpen, setIsSpecialtiesOpen] = useState(false);
  const [isAboutOpen, setIsAboutOpen] = useState(false);
  const [isRajGroupOpen, setIsRajGroupOpen] = useState(false);
  const [isNewsOpen, setIsNewsOpen] = useState(false);
  const [isAcademicsOpen, setIsAcademicsOpen] = useState(false);

  // New states for scroll direction
  const [scrollDirection, setScrollDirection] = useState('up');
  const [lastScrollY, setLastScrollY] = useState(0);
  const [showMiddleRow, setShowMiddleRow] = useState(true);

  const location = useLocation();

  useEffect(() => {
    const handleScroll = () => {
      const currentScrollY = window.scrollY;

      // Set scrolled state
      setIsScrolled(currentScrollY > 50);

      // Determine scroll direction
      if (currentScrollY > lastScrollY && currentScrollY > 100) {
        // Scrolling down & past threshold
        setScrollDirection('down');
        setShowMiddleRow(false);
      } else if (currentScrollY < lastScrollY) {
        // Scrolling up
        setScrollDirection('up');
        setShowMiddleRow(true);
      }

      setLastScrollY(currentScrollY);
    };

    window.addEventListener('scroll', handleScroll, { passive: true });
    return () => window.removeEventListener('scroll', handleScroll);
  }, [lastScrollY]);

  // Close mobile menu when route changes
  useEffect(() => {
    setIsMobileMenuOpen(false);
    setIsSpecialtiesOpen(false);
    setIsAboutOpen(false);
    setIsRajGroupOpen(false);
    setIsNewsOpen(false);
    setIsAcademicsOpen(false);
  }, [location]);

  const specialties = [
  {
    category: "Centres of Excellence",
    items: [
    "Cardiology",
    "Critical Care & Emergency",
    "Gastroenterology",
    "Minimal Access Surgery",
    "Nephrology",
    "Neurosciences",
    "Oncology (Cancer Care)",
    "Orthopaedics & Joint Replacement",
    "Pulmonology",
    "Internal Medicine",
    "Urology",
    "Obstetrics & Gynaecology"]

  },
  {
    category: "Allied Specialties",
    items: [
    "Aesthetic & Reconstructive Surgery",
    "Dental",
    "Dermatology",
    "ENT",
    "Eye Care",
    "Nutrition & Dietetics",
    "Pediatrics & Neonatology",
    "Physiotherapy & Rehabilitation",
    "Psychiatry & Mental Health"]

  },
  {
    category: "Advanced Diagnostics",
    items: [
    "Radiology",
    "Cardiology",
    "Neurology",
    "FNAC, Biopsy, Blood & Laboratory Investigations"]

  }];




  const newsItems = [
  'Press Releases',
  'Health News',
  'Medical Updates',
  'Awards & Recognition'];


  const scrollToSection = (sectionId) => {
    if (location.pathname === '/') {
      const element = document.getElementById(sectionId);
      if (element) {
        element.scrollIntoView({ behavior: 'smooth' });
      }
    }
    setIsMobileMenuOpen(false);
    setIsSpecialtiesOpen(false);
    setIsAboutOpen(false);
    setIsRajGroupOpen(false);
    setIsNewsOpen(false);
    setIsAcademicsOpen(false);
  };

  const isActivePath = (path) => {
    return location.pathname === path;
  };

  return (
    <>
      {/* Top Orange Bar with light orange background */}
 <div className="bg-gradient-to-r from-orange-400 to-orange-500 text-white py-2 sm:py-1 fixed top-0 left-0 right-0 z-50 shadow-sm">
  <div className="max-w-7xl mx-auto px-3 sm:px-4">
    
    {/* Mobile Layout - Stacked */}
    <div className="flex flex-col space-y-2 sm:hidden">
      {/* Top Row - Social Media & Location */}
      <div className="hidden md:flex items-center justify-center space-x-6">
        {/* Social Media Icons */}
        <div className="flex items-center space-x-3">
          <a href="https://facebook.com" target="_blank" rel="noopener noreferrer" className="hover:text-orange-200 transition-colors">
            <SafeIcon icon={FiFacebook} className="w-5 h-5" />
          </a>
          <a href="https://instagram.com" target="_blank" rel="noopener noreferrer" className="hover:text-orange-200 transition-colors">
            <SafeIcon icon={FiInstagram} className="w-5 h-5" />
          </a>
          <a href="https://youtube.com" target="_blank" rel="noopener noreferrer" className="hover:text-orange-200 transition-colors">
            <SafeIcon icon={FiYoutube} className="w-5 h-5" />
          </a>
        </div>
        
        {/* Location Icon */}
        <a href="/location" className="flex items-center space-x-1 hover:text-orange-200 transition-colors">
          <SafeIcon icon={FiMapPin} className="w-5 h-5" />
          <span className="text-sm font-medium">Location</span>
        </a>
      </div>
      
      {/* Bottom Row - Helpline */}
      <div className="flex items-center justify-center">
        <div className="flex items-center space-x-2">
          <SafeIcon icon={FiBell} className="w-4 h-4 text-red-300" />
          <a href="tel:+919771488888" className="text-sm font-medium hover:underline">
            (24×7) Helpline: +91 97714 88888
          </a>
        </div>
      </div>
    </div>

    {/* Desktop Layout - Horizontal */}
    <div className="hidden sm:flex justify-between items-center gap-4">
      {/* Left Side - Social Media Icons & Location */}
      <div className="flex items-center space-x-4">
        {/* Social Media Icons */}
        <div className="flex items-center space-x-2">
          <a href="https://facebook.com" target="_blank" rel="noopener noreferrer" className="hover:text-orange-200 transition-colors">
            <SafeIcon icon={FiFacebook} className="w-4 h-4" />
          </a>
          <a href="https://instagram.com" target="_blank" rel="noopener noreferrer" className="hover:text-orange-200 transition-colors">
            <SafeIcon icon={FiInstagram} className="w-4 h-4" />
          </a>
          <a href="https://youtube.com" target="_blank" rel="noopener noreferrer" className="hover:text-orange-200 transition-colors">
            <SafeIcon icon={FiYoutube} className="w-4 h-4" />
          </a>
        </div>
        
        {/* Location Icon */}
        <a href="/location" className="flex items-center space-x-1 hover:text-orange-200 transition-colors">
          <SafeIcon icon={FiMapPin} className="w-4 h-4" />
          <span className="text-sm font-medium">Location</span>
        </a>
      </div>

      {/* Right Side - Helpline */}
      <div className="flex items-center">
        <div className="flex items-center space-x-2">
          <SafeIcon icon={FiBell} className="w-4 h-4 text-red-300" />
          <a href="tel:+919771488888" className="text-sm font-medium hover:underline">
            (24×7) Helpline: +91 97714 88888
          </a>
        </div>
      </div>
    </div>
  </div>
      </div>


      {/* Main Header with dynamic height */}
      <header className={`fixed w-full z-40 transition-all duration-300 ${
      isScrolled ? 'bg-white shadow-lg top-6' : 'bg-white top-6'}`
      }>
        <div className="max-w-7xl mx-auto px-4">
          {/* Logo and Main Container with fixed height - responsive */}
          <div className="flex items-center justify-between h-16 md:h-20 lg:h-24">
              {/* Logo with responsive and dynamic sizing */}
              <Link to="/" className="flex items-center">
                <div className={`flex items-center transition-all duration-300 ${
              showMiddleRow ?
              'space-x-2 sm:space-x-3 md:space-x-4 lg:space-x-6' :
              'space-x-3 sm:space-x-4 md:space-x-5 lg:space-x-6'}`
              }>
                  {/* Main Logo - Responsive and dynamic sizing */}
                  <img
                  src="/assets/Header/main-logo_ranchi.png"
                  alt="Main Logo"
                  className={`object-contain transition-all duration-300 ${
                  showMiddleRow ?
                  'w-[60px] h-[60px] sm:w-[80px] sm:h-[80px] md:w-[100px] md:h-[100px] lg:w-[140px] lg:h-[140px]' // Both rows visible
                  : 'w-[70px] h-[70px] sm:w-[90px] sm:h-[90px] md:w-[110px] md:h-[110px] lg:w-[120px] lg:h-[120px]' // One row visible - larger than before
                  }`} />


                  {/* NABH Logos - Responsive and dynamic sizing */}
                  <div className={`flex transition-all duration-300 ${
                showMiddleRow ?
                'space-x-1 sm:space-x-2 md:space-x-2 lg:space-x-2' :
                'space-x-2 sm:space-x-3 md:space-x-2 lg:space-x-2'}`
                }>
                    <img
                    src="/assets/Header/NABL_logo-1.png"
                    alt="NABH Logo 1"
                    className={`object-contain transition-all duration-300 ${
                    showMiddleRow ?
                    'w-[30px] h-[30px] ' :
                    'w-[35px] h-[35px] ' // Larger when one row
                    }`} />

                    <img
                    src="/assets/Header/NABL-Logo-2.png"
                    alt="NABH Logo 2"
                    className={`object-contain transition-all duration-300 ${
                    showMiddleRow ?
                    'w-[30px] h-[30px] ' :
                    'w-[35px] h-[35px]'}`
                    } />

                    <img
                    src="/assets/Header/NABL-Logo-3.png"
                    alt="NABH Logo 3"
                    className={`object-contain transition-all duration-300 ${
                    showMiddleRow ?
                    'w-[30px] h-[30px]' :
                    'w-[35px] h-[35px]'}`
                    } />

                  </div>
                </div>
              </Link>

              {/* Navigation Container - Responsive */}
              <div className="hidden md:flex lg:flex flex-col items-end space-y-1 lg:space-y-2">
                
                {/* First Row of Navigation - Animated hide/show */}
                <AnimatePresence>
                  {showMiddleRow &&
                <motion.nav
                  initial={{ opacity: 0, height: 0 }}
                  animate={{ opacity: 1, height: 'auto' }}
                  exit={{ opacity: 0, height: 0 }}
                  transition={{ duration: 0.3, ease: 'easeInOut' }}
                  className="flex items-center space-x-3 md:space-x-4 lg:space-x-6 overflow-hidden">

               
                                      <Link to="/" className="text-gray-700 hover:text-gray-900 transition-colors font-medium text-sm lg:text-base">
                    Home
                  </Link>
                

                      <div
                    className="relative cursor-pointer"
                    onMouseEnter={() => setIsNewsOpen(true)}
                    onMouseLeave={() => setIsNewsOpen(false)}>

                        <div className="flex items-center space-x-1 text-gray-700 hover:text-gray-900 transition-colors font-medium text-sm lg:text-base">
                          <span>News & Media</span>
                          <SafeIcon icon={FiChevronDown} className="w-3 h-3" />
                        </div>
                        <AnimatePresence>
                          {isNewsOpen &&
                      <motion.div
                        initial={{ opacity: 0, y: -10 }}
                        animate={{ opacity: 1, y: 0 }}
                        exit={{ opacity: 0, y: -10 }}
                        className="absolute top-full left-0 mt-2 w-48 bg-white rounded-lg shadow-xl border border-gray-100 py-4 z-20">

                              <div className="flex flex-col gap-1">
                                {newsItems.map((item) =>
                          <Link key={item} to="/news" className="px-4 py-2 text-sm text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors">
                                    {item}
                                  </Link>
                          )}
                              </div>
                            </motion.div>
                      }
                        </AnimatePresence>
                      </div>

                   

                               <Link to="/testimonials" className="text-gray-700 hover:text-gray-900 transition-colors font-medium text-sm lg:text-base">
                    Testimonials
                  </Link>

                     <Link to="/careers" className="text-orange-500 hover:text-orange-600 transition-colors font-medium text-sm lg:text-base">
                        Careers
                      </Link>
                      
                      <Link to="/biomedical-waste-reports" className="text-gray-700 hover:text-gray-900 transition-colors font-medium text-sm lg:text-base">
                        Waste Reports
                      </Link>

               
                    </motion.nav>
                }
                </AnimatePresence>

                {/* Second Row of Navigation - Always visible, responsive */}
                <nav className="flex items-center space-x-3 md:space-x-4 lg:space-x-6">


        <Link to="/about" className="text-gray-700 hover:text-gray-900 transition-colors font-medium text-sm lg:text-base">
                        About Raj
                      </Link>

                  <div
                  className="relative cursor-pointer"
                  onMouseEnter={() => setIsSpecialtiesOpen(true)}
                  onMouseLeave={() => setIsSpecialtiesOpen(false)}>

                    <div className="flex items-center space-x-1 text-gray-700 hover:text-gray-900 transition-colors font-medium text-sm lg:text-base">
                      <span>Specialities</span>
                      <SafeIcon icon={FiChevronDown} className="w-3 h-3" />
                    </div>
                    <AnimatePresence>
                  {isSpecialtiesOpen &&
                    <motion.div
                      initial={{ opacity: 0, y: -10 }}
                      animate={{ opacity: 1, y: 0 }}
                      exit={{ opacity: 0, y: -10 }}
                      transition={{ duration: 0.25, ease: "easeOut" }}
                      className="absolute top-full mt-4 z-20
               /* Mobile: full width with margin */
               w-[calc(100vw-2rem)] mx-4
               /* Small screens: slightly smaller */
               sm:w-[calc(100vw-4rem)] sm:mx-8
               /* Medium screens: fixed width */
               md:w-[600px] md:mx-0
               /* Large screens: larger width */
               lg:w-[800px]
               /* Extra large screens: max width */
               xl:w-[900px]
               bg-white rounded-2xl shadow-2xl border border-gray-100 z-20
               /* Mobile: smaller padding */
               py-4 px-4
               /* Medium screens: larger padding */
               md:py-6 md:px-6">





































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































    <div className="grid gap-6
                    /* Mobile: single column */
                    grid-cols-1
                    /* Small tablets: 2 columns */
                    sm:grid-cols-2
                    /* Large tablets and desktop: 3 columns */
                    lg:grid-cols-3">








































































































































































































































































































































































































































































































































































































































































































































































































































































































































































      {specialties.map((category, idx) =>
                        <div key={idx} className="flex flex-col">
          {/* Category Heading */}
          <h4 className="font-semibold text-orange-600 uppercase tracking-wide mb-3 
                         border-b border-orange-200 pb-2
                         /* Mobile: smaller text */
                         text-xs
                         /* Medium screens: larger text */
                         md:text-sm">












































































































































































































































































































































































































































































































































































































































































































































































































            {category.category}
          </h4>
          
          {/* Items */}
          <div className="flex flex-col gap-1.5">
            {category.items.map((specialty) =>
                            <Link
                              key={specialty}
                              to="/specialties"
                              className="px-3 py-2 text-gray-700 leading-tight
                           hover:bg-orange-50 hover:text-orange-600
                           hover:scale-[1.01] transition-all duration-200 
                           rounded-lg border border-transparent
                           hover:border-orange-200 text-left
                           /* Mobile: smaller text and padding */
                           text-xs py-1.5
                           /* Small screens: medium text */
                           sm:text-sm sm:py-2
                           /* Ensure proper line height for wrapping */
                           leading-relaxed break-words">

























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































                {specialty}
              </Link>
                            )}
          </div>
        </div>
                        )}
    </div>
    
    {/* Mobile: Add scroll indicator if needed */}
    <div className="block sm:hidden mt-4 text-center">
      <div className="w-12 h-1 bg-gray-300 rounded-full mx-auto"></div>
    </div>
  </motion.div>
                    }
                    </AnimatePresence>
                  </div>

            

                  <Link to="/doctors" className="text-gray-700 hover:text-gray-900 transition-colors font-medium text-sm lg:text-base">
                    Find a Doctor
                  </Link>

             

 <div className="flex items-center space-x-3 ml-2 lg:ml-4">
  <Link
                    to="/contact"
                    className="bg-orange-500 text-white px-4 lg:px-7 py-2 lg:py-2.5 rounded-full hover:bg-orange-600 transition-colors font-semibold text-sm lg:text-base shadow-md">

    Book Appointment
  </Link>
                </div>
                </nav>
              </div>

              {/* Mobile Menu Button - Responsive */}
              <button
              onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
              className="md:hidden p-2 text-gray-700">

                <SafeIcon icon={isMobileMenuOpen ? FiX : FiMenu} className="w-5 h-5 sm:w-6 sm:h-6" />
              </button>
            </div>
        </div>

        {/* Mobile Menu */}
        <AnimatePresence>
          {isMobileMenuOpen &&
          <motion.div
            initial={{ opacity: 0, height: 0 }}
            animate={{ opacity: 1, height: 'auto' }}
            exit={{ opacity: 0, height: 0 }}
            className="lg:hidden bg-white border-t border-gray-100 max-h-[80vh] overflow-y-auto">

              <div className="px-4 py-4 space-y-4">
                <Link to="/about" className="block py-2 text-gray-700 hover:text-blue-600 transition-colors" onClick={() => setIsMobileMenuOpen(false)}>
                  About Raj
                </Link>
                <Link to="/contact" className="block py-2 text-gray-700 hover:text-blue-600 transition-colors" onClick={() => setIsMobileMenuOpen(false)}>
                  Health Check-Ups
                </Link>
                <Link to="/news" className="block py-2 text-gray-700 hover:text-blue-600 transition-colors" onClick={() => setIsMobileMenuOpen(false)}>
                  News & Media
                </Link>
                <Link to="/contact" className="block py-2 text-gray-700 hover:text-blue-600 transition-colors" onClick={() => setIsMobileMenuOpen(false)}>
                  Contact Us
                </Link>
                <Link to="/doctors" className="block py-2 text-gray-700 hover:text-blue-600 transition-colors" onClick={() => setIsMobileMenuOpen(false)}>
                  Doctors
                </Link>
                <Link to="/specialties" className="block py-2 text-gray-700 hover:text-blue-600 transition-colors" onClick={() => setIsMobileMenuOpen(false)}>
                  Specialities
                </Link>
                <Link to="/biomedical-waste-reports" className="block py-2 text-gray-700 hover:text-blue-600 transition-colors" onClick={() => setIsMobileMenuOpen(false)}>
                  Waste Reports
                </Link>
                
                <div className="pt-4 space-y-3">
                  <button
                  onClick={() => {
                    setIsMobileMenuOpen(false);
                    scrollToSection('contact');
                  }}
                  className="w-full bg-orange-500 text-white py-3 rounded-lg font-medium">

                    Book Appointment
                  </button>
                  <button className="w-full bg-yellow-500 text-black py-3 rounded-lg font-medium">
                    Write to Chairman
                  </button>
                </div>
              </div>
            </motion.div>
          }
        </AnimatePresence>
      </header>

      {/* Responsive Dynamic Spacer for fixed header */}
     
    </>);

};

export default Header;